<div class="bg-gray-50 dark:bg-gray-900 p-3 md:p-4 mb-4 md:mb-6 rounded-lg">
  <h1
    class="text-base md:text-lg font-semibold text-gray-800 dark:text-white mb-4 md:mb-6"
  >
    Mi Perfil
  </h1>
  <div class="p-4 md:p-6 max-w-5xl mx-auto">
    <!-- T√çTULO -->

    <!-- CARD -->
    <div
      *ngIf="!loading; else loadingTpl"
      class="bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm p-4 md:p-6 place-content-center mx-auto transition-colors"
    >
      <!-- INPUT ARCHIVO OCULTO -->
      <input
        type="file"
        id="profileImageInput"
        accept="image/*"
        class="hidden"
        (change)="onFileChange($event)"
      />

      <!-- HEADER PERFIL -->
      <div
        class="flex flex-col sm:flex-row items-center gap-4 md:gap-6 mb-6 md:mb-8"
      >
        <!-- AVATAR -->
        <div class="relative w-20 h-20 md:w-24 md:h-24">
          <img
            [src]="imagePreview || user.imageUrl || 'https://i.pravatar.cc/120'"
            class="w-20 h-20 md:w-24 md:h-24 rounded-full border border-gray-300 dark:border-gray-600 object-cover"
          />

          <button
            *ngIf="isEditing"
            (click)="triggerFileInput()"
            type="button"
            class="absolute bottom-0 right-0 w-7 h-7 md:w-8 md:h-8 rounded-full bg-blue-600 dark:bg-blue-500 border border-blue-700 dark:border-blue-400 shadow flex items-center justify-center hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors text-white text-sm md:text-base"
          >
            üì∑
          </button>
        </div>

        <!-- NOMBRE -->
        <div class="text-center sm:text-left">
          <p
            class="text-sm md:text-base font-medium text-gray-800 dark:text-white"
          >
            {{ user.nombres }}
          </p>
          <p class="text-xs md:text-sm text-gray-600 dark:text-gray-400">
            {{ user.apellidos }}
          </p>
        </div>
      </div>

      <!-- SECCI√ìN: CONFIGURACI√ìN GENERAL -->
      <div class="mb-6">
        <div
          class="bg-gray-100 dark:bg-gray-700/50 text-xs md:text-sm text-gray-700 dark:text-gray-300 px-3 md:px-4 py-2 rounded-lg mb-3 md:mb-4"
        >
          Configuraci√≥n general de la cuenta
        </div>

        <form [formGroup]="form">
          <!-- NOMBRE -->
          <div
            class="flex flex-col sm:flex-row sm:justify-between sm:items-center py-3 gap-2"
          >
            <div class="flex-1">
              <p class="text-xs text-gray-500 dark:text-gray-400">Nombre</p>
              <input
                *ngIf="isEditing"
                type="text"
                formControlName="nombres"
                class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:ring-2 focus:ring-blue-500"
              />
              <p
                *ngIf="!isEditing"
                class="text-sm text-gray-800 dark:text-gray-200"
              >
                {{ user.nombres }}
              </p>
            </div>
          </div>

          <!-- APELLIDOS -->
          <div
            class="flex flex-col sm:flex-row sm:justify-between sm:items-center py-3 gap-2"
          >
            <div class="flex-1">
              <p class="text-xs text-gray-500 dark:text-gray-400">Apellidos</p>
              <input
                *ngIf="isEditing"
                type="text"
                formControlName="apellidos"
                class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:ring-2 focus:ring-blue-500"
              />
              <p
                *ngIf="!isEditing"
                class="text-sm text-gray-800 dark:text-gray-200"
              >
                {{ user.apellidos }}
              </p>
            </div>
          </div>

          <!-- CORREO -->
          <div
            class="flex flex-col sm:flex-row sm:justify-between sm:items-center py-3 gap-2"
          >
            <div class="flex-1">
              <p class="text-xs text-gray-500 dark:text-gray-400">
                Correo electr√≥nico
              </p>
              <input
                *ngIf="isEditing"
                type="email"
                formControlName="email"
                class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:ring-2 focus:ring-blue-500"
              />
              <p
                *ngIf="!isEditing"
                class="text-sm text-gray-800 dark:text-gray-200 break-all"
              >
                {{ user.email }}
              </p>
            </div>
          </div>

          <!-- TEL√âFONO -->
          <div
            class="flex flex-col sm:flex-row sm:justify-between sm:items-center py-3 gap-2"
          >
            <div class="flex-1">
              <p class="text-xs text-gray-500 dark:text-gray-400">Tel√©fono</p>
              <input
                *ngIf="isEditing"
                type="tel"
                formControlName="telefono"
                placeholder="Ingrese su tel√©fono"
                class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:ring-2 focus:ring-blue-500"
              />
              <p
                *ngIf="!isEditing"
                class="text-sm text-gray-400 dark:text-gray-500"
              >
                {{ user.telefono || "No configurado" }}
              </p>
            </div>
          </div>

          <!-- FECHA NACIMIENTO -->
          <div
            class="flex flex-col sm:flex-row sm:justify-between sm:items-center py-3 gap-2"
          >
            <div class="flex-1">
              <p class="text-xs text-gray-500 dark:text-gray-400">
                Fecha de nacimiento
              </p>
              <input
                *ngIf="isEditing"
                type="date"
                formControlName="fechaNacimiento"
                class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:ring-2 focus:ring-blue-500"
              />
              <p
                *ngIf="!isEditing"
                class="text-sm text-gray-400 dark:text-gray-500"
              >
                {{ user.fechaNacimiento || "No configurada" }}
              </p>
            </div>
          </div>
        </form>
      </div>

      <!-- BOTONES DE ACCI√ìN -->
      <div class="flex gap-2 md:gap-3 justify-end mt-6">
        <button
          *ngIf="!isEditing"
          (click)="toggleEdit()"
          type="button"
          class="px-4 py-2 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors"
        >
          Editar perfil
        </button>

        <button
          *ngIf="isEditing"
          (click)="toggleEdit()"
          type="button"
          [disabled]="saving"
          class="px-4 py-2 text-sm bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors disabled:opacity-50"
        >
          Cancelar
        </button>

        <button
          *ngIf="isEditing"
          (click)="save()"
          type="button"
          [disabled]="saving || form.invalid"
          class="px-4 py-2 text-sm bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors disabled:opacity-50"
        >
          {{ saving ? "Guardando..." : "Guardar cambios" }}
        </button>
      </div>
    </div>
  </div>

  <ng-template #loadingTpl>
    <p class="text-gray-500 dark:text-gray-400 p-4 md:p-6">
      Cargando perfil...
    </p>
  </ng-template>
</div>

<div
  class="min-h-screen bg-gray-100 dark:bg-slate-900 p-4 md:p-8 flex items-center justify-center"
>
  <div
    class="bg-slate-50 dark:bg-gray-800/95 backdrop-blur-xl border border-gray-200 dark:border-gray-700 rounded-2xl p-6 md:p-10 lg:p-12 max-w-2xl w-full shadow-2xl transition-all"
  >
    <!-- HEADER CON ICONO -->
    <div class="mb-8 md:mb-10">
      <div class="flex items-center gap-3 mb-4">
        <div
          class="p-3 rounded-xl bg-gradient-to-br from-violet-500 to-indigo-600"
        >
          <svg
            class="w-6 h-6 md:w-7 md:h-7 text-white"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            viewBox="0 0 24 24"
          >
            <circle cx="12" cy="8" r="4" />
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M4 20c0-2.5 3-5 8-5s8 2.5 8 5"
            />
          </svg>
        </div>
        <h2
          class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white"
        >
          <ng-container [ngSwitch]="mode">
            <span *ngSwitchCase="'create'">Crear Usuario</span>
            <span *ngSwitchCase="'edit'">Editar Usuario</span>
            <span *ngSwitchCase="'view'">Detalles del Usuario</span>
          </ng-container>
        </h2>
      </div>

      <p
        class="text-sm md:text-base text-gray-600 dark:text-gray-400 ml-0 md:ml-12"
      >
        <ng-container [ngSwitch]="mode">
          <span *ngSwitchCase="'create'"
            >Ingresa los detalles del nuevo usuario</span
          >
          <span *ngSwitchCase="'edit'"
            >Actualiza la información del usuario</span
          >
          <span *ngSwitchCase="'view'">Visualiza los detalles del usuario</span>
        </ng-container>
      </p>
    </div>

    <form [formGroup]="form" class="space-y-6 md:space-y-8">
      <!-- EMAIL -->
      <div>
        <label
          class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
        >
          Correo electrónico
        </label>

        <input
          type="email"
          formControlName="email"
          [readonly]="mode === 'view'"
          placeholder="admin@zzootec.com"
          class="w-full px-4 py-2.5 md:py-3 text-sm md:text-base rounded-form border bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 read-only:bg-gray-50 dark:read-only:bg-gray-600 transition-colors"
          [ngClass]="{
            'border-gray-300 dark:border-gray-600 focus:ring-primary/40 focus:border-primary':
              !isFieldInvalid('email'),
            'border-red-500 ring-2 ring-red-200 dark:ring-red-900/50':
              isFieldInvalid('email'),
          }"
        />
        <p
          *ngIf="isFieldInvalid('email')"
          class="text-red-500 dark:text-red-400 text-xs md:text-sm mt-1"
        >
          {{ getErrorMessage("email") }}
        </p>
      </div>

      <!-- NOMBRES Y APELLIDOS -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
            >Nombres</label
          >
          <input
            type="text"
            formControlName="nombres"
            [readonly]="mode === 'view'"
            placeholder="Juan"
            class="w-full px-4 py-2.5 md:py-3 text-sm md:text-base rounded-form border bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 read-only:bg-gray-50 dark:read-only:bg-gray-600 transition-colors"
          />
        </div>

        <div>
          <label
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
            >Apellidos</label
          >
          <input
            type="text"
            formControlName="apellidos"
            [readonly]="mode === 'view'"
            placeholder="Pérez"
            class="w-full px-4 py-2.5 md:py-3 text-sm md:text-base rounded-form border bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 read-only:bg-gray-50 dark:read-only:bg-gray-600 transition-colors"
          />
        </div>
      </div>

      <!-- TELÉFONO -->
      <div>
        <label
          class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
        >
          Teléfono
        </label>

        <input
          type="tel"
          formControlName="telefono"
          [readonly]="mode === 'view'"
          placeholder="987654321"
          maxlength="15"
          class="w-full px-4 py-2.5 md:py-3 text-sm md:text-base rounded-form border bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 read-only:bg-gray-50 dark:read-only:bg-gray-600 transition-colors"
          [ngClass]="{
            'border-gray-300 dark:border-gray-600 focus:ring-primary/40 focus:border-primary':
              !isFieldInvalid('telefono'),
            'border-red-500 ring-2 ring-red-200 dark:ring-red-900/50':
              isFieldInvalid('telefono'),
          }"
        />
        <p
          *ngIf="isFieldInvalid('telefono')"
          class="text-red-500 dark:text-red-400 text-xs md:text-sm mt-1"
        >
          {{ getErrorMessage("telefono") }}
        </p>
      </div>

      <!-- FECHA DE NACIMIENTO -->
      <div>
        <label
          class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
        >
          Fecha de nacimiento
        </label>

        <input
          type="date"
          formControlName="fechaNacimiento"
          [readonly]="mode === 'view'"
          class="w-full px-4 py-2.5 md:py-3 text-sm md:text-base rounded-form border bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 read-only:bg-gray-50 dark:read-only:bg-gray-600 transition-colors"
          [ngClass]="{
            'border-gray-300 dark:border-gray-600 focus:ring-primary/40 focus:border-primary':
              !isFieldInvalid('fechaNacimiento'),
            'border-red-500 ring-2 ring-red-200 dark:ring-red-900/50':
              isFieldInvalid('fechaNacimiento'),
          }"
        />
        <p
          *ngIf="isFieldInvalid('fechaNacimiento')"
          class="text-red-500 dark:text-red-400 text-xs md:text-sm mt-1"
        >
          {{ getErrorMessage("fechaNacimiento") }}
        </p>
      </div>

      <!-- IMAGEN DE PERFIL -->
      <div>
        <label
          class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
        >
          Imagen de perfil
        </label>

        <input
          type="file"
          #fileInput
          accept="image/*"
          class="hidden"
          (change)="onFileChange($event)"
          [disabled]="mode === 'view'"
        />

        <div class="flex items-center gap-4">
          <div
            *ngIf="imagePreview || currentImage"
            class="w-20 h-20 rounded-full overflow-hidden border-2 border-gray-300 dark:border-gray-600"
          >
            <img
              [src]="imagePreview || currentImage"
              class="w-full h-full object-cover"
              alt="Preview"
            />
          </div>

          <button
            *ngIf="mode !== 'view'"
            type="button"
            (click)="fileInput.click()"
            class="px-4 py-2 text-sm rounded-form border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors"
          >
            {{
              imagePreview || currentImage
                ? "Cambiar imagen"
                : "Seleccionar imagen"
            }}
          </button>
        </div>

        <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
          Formatos: JPG, PNG, WEBP (máx. 5MB)
        </p>
      </div>

      <!-- PASSWORD (NO VIEW) -->
      <div *ngIf="mode !== 'view'">
        <label
          class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
          >Contraseña</label
        >
        <input
          type="password"
          formControlName="password"
          placeholder="Dejar en blanco para no cambiar"
          class="w-full px-4 py-2.5 md:py-3 text-sm md:text-base rounded-form border bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 transition-colors"
        />
        <p
          *ngIf="isFieldInvalid('password')"
          class="text-red-500 dark:text-red-400 text-xs md:text-sm mt-1"
        >
          {{ getErrorMessage("password") }}
        </p>
      </div>

      <!-- ROL -->
      <div>
        <label
          class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
        >
          Rol de usuario
        </label>

        <select
          formControlName="roles"
          [disabled]="mode === 'view'"
          class="w-full px-4 py-2.5 md:py-3 text-sm md:text-base rounded-form border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary/40 focus:border-primary disabled:bg-gray-50 dark:disabled:bg-gray-600 transition-colors"
        >
          <option *ngFor="let r of roles" [value]="r">
            {{ r }}
          </option>
        </select>
      </div>

      <!-- ACTIVO -->
      <div
        class="flex items-center gap-3 p-3 md:p-4 border border-gray-200 dark:border-gray-700 rounded-form bg-gray-50 dark:bg-gray-700/50"
      >
        <input
          type="checkbox"
          formControlName="activo"
          class="w-5 h-5 accent-primary"
        />

        <label
          class="text-xs md:text-sm text-gray-700 dark:text-gray-300 font-medium"
        >
          Usuario activo
        </label>
      </div>

      <!-- BOTONES -->
      <div
        class="flex flex-col sm:flex-row justify-between gap-3 md:gap-4 pt-8 md:pt-10 border-t border-gray-200 dark:border-gray-700 mt-8 md:mt-10"
      >
        <button
          type="button"
          class="px-6 py-3 md:py-3.5 text-sm md:text-base rounded-lg bg-gray-100 dark:bg-gray-700/50 text-gray-700 dark:text-gray-300 font-semibold hover:bg-gray-200 dark:hover:bg-gray-600 transition-all duration-200"
          (click)="back()"
        >
          {{ mode === "view" ? "← Volver" : "✕ Cancelar" }}
        </button>

        <button
          *ngIf="mode !== 'view'"
          type="button"
          class="px-8 py-3 md:py-3.5 text-sm md:text-base rounded-lg bg-gradient-to-r from-violet-600 to-violet-700 text-white font-semibold hover:from-violet-700 hover:to-violet-800 shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105"
          (click)="submit()"
        >
          {{ mode === "create" ? "✓ Crear Usuario" : "✓ Guardar Cambios" }}
        </button>
      </div>
    </form>
  </div>
</div>
